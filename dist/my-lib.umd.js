var v=Object.defineProperty,S=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var C=(n,i,r)=>i in n?v(n,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[i]=r,l=(n,i)=>{for(var r in i||(i={}))H.call(i,r)&&C(n,r,i[r]);if(F)for(var r of F(i))O.call(i,r)&&C(n,r,i[r]);return n},h=(n,i)=>S(n,E(i));var o=(n,i,r)=>(C(n,typeof i!="symbol"?i+"":i,r),r);(function(n,i){typeof exports=="object"&&typeof module!="undefined"?i(exports,require("axios"),require("lodash-es"),require("element-plus"),require("vant")):typeof define=="function"&&define.amd?define(["exports","axios","lodash-es","element-plus","vant"],i):(n=typeof globalThis!="undefined"?globalThis:n||self,i(n.MyLib={},n.axios,n["lodash-es"],n["element-plus"],n.vant))})(this,function(n,i,r,x,B){"use strict";function T(u){return u&&typeof u=="object"&&"default"in u?u:{default:u}}var p=T(i);class D{constructor(){o(this,"_dataType",{})}proxyData(){return new Proxy(this,{get(e,t){if(t in e)return e[t];if(e.data)return e.data[t]},set(e,t,s){return t in e?(e[t]=s,!0):(e.data&&t in e.data&&(e.data[t]=s),!0)},has(e,t){return t in e||e.data&&t in e.data}})}}const g=class{constructor(){o(this,"config",{});o(this,"response");o(this,"error")}setCancel(){let{config:e}=this;if(e.cancelMark==="")return;let t;e.cancelMark=t=e.cancelMark||"default";let{cancelMapByMark:s}=g,a=s[t]=s[t]||p.default.CancelToken.source();e.cancelToken=a.token}static cancelByMark(e){let{cancelMapByMark:t}=g;!t[e]||(t[e].cancel(),delete t[e])}request(e={}){return this.config=l(l({},this.config),e),this.requestHandle(),this.setCancel(),p.default.request(this.config).then(t=>(this.response=t,this.responseHandle())).catch(t=>{throw this.error=t,this.errorHandle()})}setGet(e,t={},s={}){return this.config=l(h(l({},this.config),{url:e,params:t}),s),this}setPost(e,t={},s={},a={}){return this.config=l(h(l({},this.config),{url:e,data:t,params:s}),a),this}get(e,t={},s={}){return this.request(l({method:"get",url:e,params:t},s))}post(e,t={},s={},a={}){return this.request(l({method:"post",url:e,data:t},a))}};let L=g;o(L,"cancelMapByMark",{});const d=class{constructor(e={}){o(this,"needWaitLoading",!0);o(this,"reqIngNum",0);o(this,"reqCount",0);o(this,"fullLoadingSingleInst");o(this,"isFull",!1);o(this,"loadingInst");o(this,"_options",{});o(this,"options",{});o(this,"_waitLoading");o(this,"_waitClose");const t=d.defaultConfigByClassName[this.classname]||{};return this.options=l(l(l({},this.options),t),e),this.isFull=this.getIsFull(),this}get classname(){return this.constructor.name}setDefaultConfig(e){d.defaultConfigByClassName[this.classname]=e}get fullInst(){const e=this.constructor.name;return d._firstFullInstMapByClassName[e]||(d._firstFullInstMapByClassName[e]=this),d._firstFullInstMapByClassName[e]}startLoading(){if(!this.isFull){this.loadingInst=this.buildLoading();return}this.fullStart()}endLoading(){if(!this.isFull){this.closeLoading(this.loadingInst);return}this.fullClose()}fullStart(){const e=this.fullInst;e.reqIngNum++,e.reqCount++,e.needWaitLoading&&(e.waitLoading(),e.needWaitLoading=!1),this.upText(this.getText()),e.waitClose.cancel()}get waitLoading(){const e=this.fullInst;return e._waitLoading||(e._waitLoading=r.debounce(()=>{e.fullLoadingSingleInst=this.buildLoading()},1e3)),e._waitLoading}get waitClose(){const e=this.fullInst;return e._waitClose||(e._waitClose=r.debounce(()=>{e.reqIngNum=0,e.reqCount=0,e.needWaitLoading=!0,this.closeLoading(e.fullLoadingSingleInst)},800)),e._waitClose}fullClose(){const e=this.fullInst;e.reqIngNum--,this.upText(this.getText()),e.reqIngNum<=0&&(e.waitLoading.cancel(),e.waitClose())}getText(e="\u52A0\u8F7D\u4E2D"){let{reqCount:t,reqIngNum:s}=this.fullInst;if(t>1){let a=1-s/t;a=(a*100).toFixed(0),e=`\u5DF2\u52A0\u8F7D ${a}%`}return e}};let f=d;o(f,"defaultConfigByClassName",{}),o(f,"_firstFullInstMapByClassName",{});class q extends f{getIsFull(){if(!this.options.target)return!0;const{target:e}=this.options;return(e instanceof HTMLElement?e.nodeName:e)==="body"}buildLoading(){var t;const e=x.ElLoading.service(this.options);return(t=document.querySelector("body"))==null||t.classList.remove("el-loading-parent--relative"),e}closeLoading(e){e==null||e.close()}upText(e,t){t==null||t.setText(e)}}class N extends f{getIsFull(){return!0}buildLoading(){return B.Toast.loading(this.options)}closeLoading(e){e==null||e.clear()}upText(e,t){t&&(t.messate=e)}}let w={default:q,vantToast:N,elPlus:q};function b(u){Object.assign(w,u)}new q().setDefaultConfig({target:"body",text:"\u52A0\u8F7D\u4E2D",spinner:"el-icon-loading",background:"rgba(50, 50, 50, 0.5)"});class M extends L{constructor(){super(...arguments);o(this,"isDefaultUseLoading",!0);o(this,"loading");o(this,"model")}setUseLoading(e=!0){return this.isDefaultUseLoading=e,this}setLoading(e={},t="default"){return this.loading=new w[t](e),this}getLoading(){return!this.loading&&this.isDefaultUseLoading&&this.setLoading(),this.loading}setModel(e){return this.model=e,this}getModel(){if(!this.model)throw new Error("\u8BF7\u5148\u8BBE\u7F6E\u6A21\u578B");return this.model}request(e={}){let t=this.getLoading();return t==null||t.startLoading(),super.request(e).then(s=>(t==null||t.endLoading(),s)).catch(s=>{throw t==null||t.endLoading(),s})}reqOne(e,t){return this.request().then(s=>this.getModel().newFromReq(e,s,t))}reqOneOther(e,t,s){return this.request().then(a=>{const c=a[t],m=this.getModel().newFromReq(e,c,s);return h(l({},r.omit(a,t)),{model:m})})}reqMany(e,t){return this.request().then(s=>{let a=[];for(const c of s)a.push(this.getModel().newFromReq(e,c,t));return a})}reqManyOther(e,t,s){return this.request().then(a=>{const c=a[t],m=[];for(const k of c)m.push(this.getModel().newFromReq(e,k,s));return h(l({},r.omit(a,t)),{models:m})})}}class I extends M{requestHandle(){let{config:e}=this;e.headers||(e.headers={})}responseHandle(){const{response:e}=this;if(!e)throw e;return e.data.returnContent}errorHandle(){return this.error}}let y={default:I,demo:I};function R(u){Object.assign(y,{},u)}class _ extends D{constructor(){super(...arguments);o(this,"defaultUseLoading",!0)}static newReq(e="default"){return new this().newReq(e)}newReq(e="default"){const t=new y[e];if(!t)throw new Error(`${e} \u8BF7\u6C42\u7C7B \u4E0D\u5B58\u5728`);return t.setModel(this).setUseLoading(this.defaultUseLoading)}newFromReq(e,t,s){const a=new e;return a.data=t,s&&s(a),a.proxyData()}}n.BaseLoading=f,n.LoadingRequest=M,n.RequestModel=_,n.setLoadingClassConfig=b,n.setRequestClassConfig=R,Object.defineProperty(n,"__esModule",{value:!0}),n[Symbol.toStringTag]="Module"});
