var E=Object.defineProperty,P=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var p=(n,i,a)=>i in n?E(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a,o=(n,i)=>{for(var a in i||(i={}))O.call(i,a)&&p(n,a,i[a]);if(B)for(var a of B(i))A.call(i,a)&&p(n,a,i[a]);return n},y=(n,i)=>P(n,_(i));var r=(n,i,a)=>(p(n,typeof i!="symbol"?i+"":i,a),a);(function(n,i){typeof exports=="object"&&typeof module!="undefined"?i(exports,require("lodash-es"),require("axios"),require("vue")):typeof define=="function"&&define.amd?define(["exports","lodash-es","axios","vue"],i):(n=typeof globalThis!="undefined"?globalThis:n||self,i(n.MyLib={},n["lodash-es"],n.axios,n.vue))})(this,function(n,i,a,C){"use strict";function D(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var M=D(a);class R{constructor(){r(this,"isProxyData",!1)}proxyData(){return this.isProxyData?this:(this.isProxyData=!0,new Proxy(this,{get(t,e){if(e in t)return t[e];if(t.data)return t.data[e]},set(t,e,s){return e in t?(t[e]=s,!0):t.data&&e in t.data?(t.data[e]=s,!0):(t[e]=s,!0)},has(t,e){return e in t||t.data&&e in t.data}}))}}let I={};function N(){return I}function x(l){I=l}let F={};function k(){return F}function T(l){F=l}let f={use:!0};function S(l){f=o(o({},f),l)}class q extends R{constructor(){super(...arguments);r(this,"useLoading",f.use);r(this,"_req")}static newReq(t="default"){const e=N(),s=new e[t];if(!s)throw new Error(`${t} \u8BF7\u6C42\u7C7B \u4E0D\u5B58\u5728`);return s}newReq(t="default"){return q.newReq(t)}get req(){if(!this._req)throw new Error(" \u8BF7\u6C42\u7C7B \u672A\u8BBE\u7F6E");return this._req}static setReq(t){return new this().setReq(t)}setReq(t){return this._req=t.setUseLoading(this.useLoading),this}async reqOne(t){return this.req.request().then(e=>this.newFromReq(e,t))}async reqOneOther(t,e){return this.req.request().then(s=>{const u=s[t],d=this.newFromReq(u,e);return o({model:d},i.omit(s,t))})}async reqMany(t){return this.req.request().then(e=>{let s=[];for(const u of e)s.push(this.newFromReq(e,t));return s})}async reqManyOther(t,e){return this.req.request().then(s=>{const u=s[t];let d=[];for(const v of u)d.push(this.newFromReq(v,e));return o({models:d},i.omit(s,t))})}newFromReq(t,e){if(!t)throw new Error(`\u6A21\u578B\u6570\u636E\u6709\u8BEF:${t}`);const s=new this.constructor(t).proxyData();return s.data=t,e&&e(s),s}}const m=class{constructor(){r(this,"config",{});r(this,"response");r(this,"error")}setCancel(){let{config:t}=this;if(t.cancelMark==="")return;let e;t.cancelMark=e=t.cancelMark||"default";let{cancelMapByMark:s}=m,u=s[e]=s[e]||M.default.CancelToken.source();t.cancelToken=u.token}static cancelByMark(t){let{cancelMapByMark:e}=m;!e[t]||(e[t].cancel(),delete e[t])}async request(t={}){return this.config=o(o({},this.config),t),this.requestHandle(),this.setCancel(),M.default.request(this.config).then(e=>(this.response=e,this.responseHandle())).catch(e=>{throw this.error=e,this.errorHandle()})}setGet(t,e={},s={}){return this.config=o(y(o({},this.config),{url:t,params:e}),s),this}setPost(t,e={},s={},u={}){return this.config=o(y(o({},this.config),{url:t,data:e,params:s}),u),this}};let L=m;r(L,"cancelMapByMark",{});class b extends L{constructor(){super(...arguments);r(this,"useLoading",f.use);r(this,"loading")}setUseLoading(t=f.use){return this.useLoading=t,this}setLoading(t={},e="default"){const s=k();return this.loading=new s[e](t),this}getLoading(){return!this.loading&&this.useLoading&&this.setLoading(),this.loading}async request(t={}){let e=this.getLoading();return e==null||e.startLoading(),super.request(t).then(s=>(e==null||e.endLoading(),s)).catch(s=>{throw e==null||e.endLoading(),s})}}const h=class{constructor(t={}){r(this,"needWaitLoading",!0);r(this,"reqIngNum",0);r(this,"reqCount",0);r(this,"fullLoadingSingleInst");r(this,"loadingInst");r(this,"_options",{});r(this,"options",{});r(this,"_waitLoading");r(this,"_waitClose");const e=h.defaultConfigByClassName[this.classname]||{};return this.options=o(o(o({},this.options),e),t),this}get isFull(){return this.getIsFull()}get classname(){return this.constructor.name}setDefaultConfig(t){h.defaultConfigByClassName[this.classname]=t}get fullInst(){const t=this.constructor.name;return h._firstFullInstMapByClassName[t]||(h._firstFullInstMapByClassName[t]=this),h._firstFullInstMapByClassName[t]}startLoading(){if(!this.isFull){this.loadingInst=this.buildLoading();return}this.fullStart()}endLoading(){if(!this.isFull){this.closeLoading(this.loadingInst);return}this.fullClose()}fullStart(){const t=this.fullInst;t.reqIngNum++,t.reqCount++,t.needWaitLoading&&(t.waitLoading(),t.needWaitLoading=!1),this.upText(this.getText()),t.waitClose.cancel()}get waitLoading(){const t=this.fullInst;return t._waitLoading||(t._waitLoading=i.debounce(()=>{t.fullLoadingSingleInst=this.buildLoading()},1e3)),t._waitLoading}get waitClose(){const t=this.fullInst;return t._waitClose||(t._waitClose=i.debounce(()=>{t.reqIngNum=0,t.reqCount=0,t.needWaitLoading=!0,this.closeLoading(t.fullLoadingSingleInst)},800)),t._waitClose}fullClose(){const t=this.fullInst;t.reqIngNum--,this.upText(this.getText()),t.reqIngNum<=0&&(t.waitLoading.cancel(),t.waitClose())}getText(t="\u52A0\u8F7D\u4E2D"){let{reqCount:e,reqIngNum:s}=this.fullInst;if(e>1){let u=1-s/e;u=(u*100).toFixed(0),t=`\u5DF2\u52A0\u8F7D ${u}%`}return t}};let g=h;r(g,"defaultConfigByClassName",{}),r(g,"_firstFullInstMapByClassName",{});const c=class{constructor(){r(this,"key","default");r(this,"isDestroy",!1)}static create(t="default",e=!0){var u,d;c.map[this.name]=(u=c.map[this.name])!=null?u:{},c.map[this.name][t]=(d=c.map[this.name][t])!=null?d:C.ref(new this);const s=c.map[this.name][t].value;return s.key=t,s.setDestroy(t,e),c.map[this.name][t]}reset(){const t=new this.constructor;t.key=this.key,t.isDestroy=this.isDestroy,c.map[this.constructor.name][this.key].value=t}setDestroy(t,e){if(this.isDestroy||!e)return;this.isDestroy=!0;const s=this.constructor.name;C.onBeforeUnmount(()=>{delete c.map[s][t]})}};let w=c;r(w,"map",{}),n.BaseLoading=g,n.LoadingRequest=b,n.RequestModel=q,n.VmVue3=w,n.setLoadingConfig=S,n.setLoadingMap=T,n.setRequestMap=x,Object.defineProperty(n,"__esModule",{value:!0}),n[Symbol.toStringTag]="Module"});
