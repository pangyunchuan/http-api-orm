var v=Object.defineProperty,E=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var p=(n,i,a)=>i in n?v(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a,u=(n,i)=>{for(var a in i||(i={}))O.call(i,a)&&p(n,a,i[a]);if(x)for(var a of x(i))U.call(i,a)&&p(n,a,i[a]);return n},g=(n,i)=>E(n,H(i));var r=(n,i,a)=>(p(n,typeof i!="symbol"?i+"":i,a),a);(function(n,i){typeof exports=="object"&&typeof module!="undefined"?i(exports,require("axios"),require("lodash-es"),require("element-plus"),require("vant")):typeof define=="function"&&define.amd?define(["exports","axios","lodash-es","element-plus","vant"],i):(n=typeof globalThis!="undefined"?globalThis:n||self,i(n.MyLib={},n.axios,n["lodash-es"],n["element-plus"],n.vant))})(this,function(n,i,a,B,T){"use strict";function D(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var w=D(i);class N{constructor(){r(this,"_dataType",{})}proxyData(){return new Proxy(this,{get(e,t){if(t in e)return e[t];if(e.data)return e.data[t]},set(e,t,s){return t in e?(e[t]=s,!0):(e.data&&t in e.data&&(e.data[t]=s),!0)},has(e,t){return t in e||e.data&&t in e.data}})}}const C=class{constructor(){r(this,"config",{});r(this,"response");r(this,"error")}setCancel(){let{config:e}=this;if(e.cancelMark==="")return;let t;e.cancelMark=t=e.cancelMark||"default";let{cancelMapByMark:s}=C,o=s[t]=s[t]||w.default.CancelToken.source();e.cancelToken=o.token}static cancelByMark(e){let{cancelMapByMark:t}=C;!t[e]||(t[e].cancel(),delete t[e])}request(e={}){return this.config=u(u({},this.config),e),this.requestHandle(),this.setCancel(),w.default.request(this.config).then(t=>(this.response=t,this.responseHandle())).catch(t=>{throw this.error=t,this.errorHandle()})}setGet(e,t={},s={}){return this.config=u(g(u({},this.config),{url:e,params:t}),s),this}setPost(e,t={},s={},o={}){return this.config=u(g(u({},this.config),{url:e,data:t,params:s}),o),this}get(e,t={},s={}){return this.request(u({method:"get",url:e,params:t},s))}post(e,t={},s={},o={}){return this.request(u({method:"post",url:e,data:t},o))}};let q=C;r(q,"cancelMapByMark",{});const d=class{constructor(e={}){r(this,"needWaitLoading",!0);r(this,"reqIngNum",0);r(this,"reqCount",0);r(this,"fullLoadingSingleInst");r(this,"isFull",!1);r(this,"loadingInst");r(this,"_options",{});r(this,"options",{});r(this,"_waitLoading");r(this,"_waitClose");const t=d.defaultConfigByClassName[this.classname]||{};return this.options=u(u(u({},this.options),t),e),this.isFull=this.getIsFull(),this}get classname(){return this.constructor.name}setDefaultConfig(e){d.defaultConfigByClassName[this.classname]=e}get fullInst(){const e=this.constructor.name;return d._firstFullInstMapByClassName[e]||(d._firstFullInstMapByClassName[e]=this),d._firstFullInstMapByClassName[e]}startLoading(){if(!this.isFull){this.loadingInst=this.buildLoading();return}this.fullStart()}endLoading(){if(!this.isFull){this.closeLoading(this.loadingInst);return}this.fullClose()}fullStart(){const e=this.fullInst;e.reqIngNum++,e.reqCount++,e.needWaitLoading&&(e.waitLoading(),e.needWaitLoading=!1),this.upText(this.getText()),e.waitClose.cancel()}get waitLoading(){const e=this.fullInst;return e._waitLoading||(e._waitLoading=a.debounce(()=>{e.fullLoadingSingleInst=this.buildLoading()},1e3)),e._waitLoading}get waitClose(){const e=this.fullInst;return e._waitClose||(e._waitClose=a.debounce(()=>{e.reqIngNum=0,e.reqCount=0,e.needWaitLoading=!0,this.closeLoading(e.fullLoadingSingleInst)},800)),e._waitClose}fullClose(){const e=this.fullInst;e.reqIngNum--,this.upText(this.getText()),e.reqIngNum<=0&&(e.waitLoading.cancel(),e.waitClose())}getText(e="\u52A0\u8F7D\u4E2D"){let{reqCount:t,reqIngNum:s}=this.fullInst;if(t>1){let o=1-s/t;o=(o*100).toFixed(0),e=`\u5DF2\u52A0\u8F7D ${o}%`}return e}};let f=d;r(f,"defaultConfigByClassName",{}),r(f,"_firstFullInstMapByClassName",{});class L extends f{getIsFull(){if(!this.options.target)return!0;const{target:e}=this.options;return(e instanceof HTMLElement?e.nodeName:e)==="body"}buildLoading(){var t;const e=B.ElLoading.service(this.options);return(t=document.querySelector("body"))==null||t.classList.remove("el-loading-parent--relative"),e}closeLoading(e){e==null||e.close()}upText(e,t){t==null||t.setText(e)}}class b extends f{getIsFull(){return!0}buildLoading(){return T.Toast.loading(this.options)}closeLoading(e){e==null||e.clear()}upText(e,t){t&&(t.messate=e)}}let y={default:L,vantToast:b,elPlus:L};function R(l){Object.assign(y,l)}new L().setDefaultConfig({target:"body",text:"\u52A0\u8F7D\u4E2D",spinner:"el-icon-loading",background:"rgba(50, 50, 50, 0.5)"});const h=require("fs");h.existsSync("./src/modelConfig/loadingClassConfig.ts")||h.copyFileSync("reqorm/src/model/config/loadingClassConfig.ts","./src/modelConfig/loadingClassConfig.ts"),h.existsSync("./src/modelConfig/requestClassConfig.ts")||h.copyFileSync("reqorm/src/model/config/requestClassConfig.ts","./src/modelConfig/requestClassConfig.ts");class M extends q{constructor(){super(...arguments);r(this,"isDefaultUseLoading",!0);r(this,"loading");r(this,"model")}setUseLoading(e=!0){return this.isDefaultUseLoading=e,this}setLoading(e={},t="default"){return this.loading=new y[t](e),this}getLoading(){return!this.loading&&this.isDefaultUseLoading&&this.setLoading(),this.loading}setModel(e){return this.model=e,this}getModel(){if(!this.model)throw new Error("\u8BF7\u5148\u8BBE\u7F6E\u6A21\u578B");return this.model}request(e={}){let t=this.getLoading();return t==null||t.startLoading(),super.request(e).then(s=>(t==null||t.endLoading(),s)).catch(s=>{throw t==null||t.endLoading(),s})}reqOne(e,t){return this.request().then(s=>this.getModel().newFromReq(e,s,t))}reqOneOther(e,t,s){return this.request().then(o=>{const c=o[t],m=this.getModel().newFromReq(e,c,s);return g(u({},a.omit(o,t)),{model:m})})}reqMany(e,t){return this.request().then(s=>{let o=[];for(const c of s)o.push(this.getModel().newFromReq(e,c,t));return o})}reqManyOther(e,t,s){return this.request().then(o=>{const c=o[t],m=[];for(const k of c)m.push(this.getModel().newFromReq(e,k,s));return g(u({},a.omit(o,t)),{models:m})})}}class I extends M{requestHandle(){let{config:e}=this;e.headers||(e.headers={})}responseHandle(){const{response:e}=this;if(!e)throw e;return e.data.returnContent}errorHandle(){return this.error}}let F={default:I,demo:I};function S(l){Object.assign(F,l)}class _ extends N{constructor(){super(...arguments);r(this,"defaultUseLoading",!0)}static newReq(e="default"){return new this().newReq(e)}newReq(e="default"){const t=new F[e];if(!t)throw new Error(`${e} \u8BF7\u6C42\u7C7B \u4E0D\u5B58\u5728`);return t.setModel(this).setUseLoading(this.defaultUseLoading)}newFromReq(e,t,s){const o=new e;return o.data=t,s&&s(o),o.proxyData()}}n.BaseLoading=f,n.LoadingRequest=M,n.RequestModel=_,n.setLoadingClassConfig=R,n.setRequestClassConfig=S,Object.defineProperty(n,"__esModule",{value:!0}),n[Symbol.toStringTag]="Module"});
