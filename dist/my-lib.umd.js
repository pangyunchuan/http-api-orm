var O=Object.defineProperty,U=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var w=(s,i,r)=>i in s?O(s,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[i]=r,u=(s,i)=>{for(var r in i||(i={}))P.call(i,r)&&w(s,r,i[r]);if(D)for(var r of D(i))$.call(i,r)&&w(s,r,i[r]);return s},h=(s,i)=>U(s,j(i));var a=(s,i,r)=>(w(s,typeof i!="symbol"?i+"":i,r),r);(function(s,i){typeof exports=="object"&&typeof module!="undefined"?i(exports,require("axios"),require("lodash-es"),require("element-plus"),require("vant")):typeof define=="function"&&define.amd?define(["exports","axios","lodash-es","element-plus","vant"],i):(s=typeof globalThis!="undefined"?globalThis:s||self,i(s.MyLib={},s.axios,s["lodash-es"],s["element-plus"],s.vant))})(this,function(s,i,r,N,b){"use strict";function R(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var M=R(i);class _{constructor(){a(this,"_dataType",{})}proxyData(){return new Proxy(this,{get(e,t){if(t in e)return e[t];if(e.data)return e.data[t]},set(e,t,n){return t in e?(e[t]=n,!0):(e.data&&t in e.data&&(e.data[t]=n),!0)},has(e,t){return t in e||e.data&&t in e.data}})}}const g=class{constructor(){a(this,"config",{});a(this,"response");a(this,"error")}setCancel(){let{config:e}=this;if(e.cancelMark==="")return;let t;e.cancelMark=t=e.cancelMark||"default";let{cancelMapByMark:n}=g,o=n[t]=n[t]||M.default.CancelToken.source();e.cancelToken=o.token}static cancelByMark(e){let{cancelMapByMark:t}=g;!t[e]||(t[e].cancel(),delete t[e])}request(e={}){return this.config=u(u({},this.config),e),this.requestHandle(),this.setCancel(),M.default.request(this.config).then(t=>(this.response=t,this.responseHandle())).catch(t=>{throw this.error=t,this.errorHandle()})}setGet(e,t={},n={}){return this.config=u(h(u({},this.config),{url:e,params:t}),n),this}setPost(e,t={},n={},o={}){return this.config=u(h(u({},this.config),{url:e,data:t,params:n}),o),this}get(e,t={},n={}){return this.request(u({method:"get",url:e,params:t},n))}post(e,t={},n={},o={}){return this.request(u({method:"post",url:e,data:t},o))}};let C=g;a(C,"cancelMapByMark",{});const d=class{constructor(e={}){a(this,"needWaitLoading",!0);a(this,"reqIngNum",0);a(this,"reqCount",0);a(this,"fullLoadingSingleInst");a(this,"isFull",!1);a(this,"loadingInst");a(this,"_options",{});a(this,"options",{});a(this,"_waitLoading");a(this,"_waitClose");const t=d.defaultConfigByClassName[this.classname]||{};return this.options=u(u(u({},this.options),t),e),this.isFull=this.getIsFull(),this}get classname(){return this.constructor.name}setDefaultConfig(e){d.defaultConfigByClassName[this.classname]=e}get fullInst(){const e=this.constructor.name;return d._firstFullInstMapByClassName[e]||(d._firstFullInstMapByClassName[e]=this),d._firstFullInstMapByClassName[e]}startLoading(){if(!this.isFull){this.loadingInst=this.buildLoading();return}this.fullStart()}endLoading(){if(!this.isFull){this.closeLoading(this.loadingInst);return}this.fullClose()}fullStart(){const e=this.fullInst;e.reqIngNum++,e.reqCount++,e.needWaitLoading&&(e.waitLoading(),e.needWaitLoading=!1),this.upText(this.getText()),e.waitClose.cancel()}get waitLoading(){const e=this.fullInst;return e._waitLoading||(e._waitLoading=r.debounce(()=>{e.fullLoadingSingleInst=this.buildLoading()},1e3)),e._waitLoading}get waitClose(){const e=this.fullInst;return e._waitClose||(e._waitClose=r.debounce(()=>{e.reqIngNum=0,e.reqCount=0,e.needWaitLoading=!0,this.closeLoading(e.fullLoadingSingleInst)},800)),e._waitClose}fullClose(){const e=this.fullInst;e.reqIngNum--,this.upText(this.getText()),e.reqIngNum<=0&&(e.waitLoading.cancel(),e.waitClose())}getText(e="\u52A0\u8F7D\u4E2D"){let{reqCount:t,reqIngNum:n}=this.fullInst;if(t>1){let o=1-n/t;o=(o*100).toFixed(0),e=`\u5DF2\u52A0\u8F7D ${o}%`}return e}};let f=d;a(f,"defaultConfigByClassName",{}),a(f,"_firstFullInstMapByClassName",{});class L extends f{getIsFull(){if(!this.options.target)return!0;const{target:e}=this.options;return(e instanceof HTMLElement?e.nodeName:e)==="body"}buildLoading(){var t;const e=N.ElLoading.service(this.options);return(t=document.querySelector("body"))==null||t.classList.remove("el-loading-parent--relative"),e}closeLoading(e){e==null||e.close()}upText(e,t){t==null||t.setText(e)}}class k extends f{getIsFull(){return!0}buildLoading(){return b.Toast.loading(this.options)}closeLoading(e){e==null||e.clear()}upText(e,t){t&&(t.messate=e)}}const I={default:L,vantToast:k,elPlus:L};let q={},y=u(u({},I),q);function v(l){q=l,Object.assign(y,I,q)}new L().setDefaultConfig({target:"body",text:"\u52A0\u8F7D\u4E2D",spinner:"el-icon-loading",background:"rgba(50, 50, 50, 0.5)"});class F extends C{constructor(){super(...arguments);a(this,"isDefaultUseLoading",!0);a(this,"loading");a(this,"model")}setUseLoading(e=!0){return this.isDefaultUseLoading=e,this}setLoading(e={},t="default"){return this.loading=new y[t](e),this}getLoading(){return!this.loading&&this.isDefaultUseLoading&&this.setLoading(),this.loading}setModel(e){return this.model=e,this}getModel(){if(!this.model)throw new Error("\u8BF7\u5148\u8BBE\u7F6E\u6A21\u578B");return this.model}request(e={}){let t=this.getLoading();return t==null||t.startLoading(),super.request(e).then(n=>(t==null||t.endLoading(),n)).catch(n=>{throw t==null||t.endLoading(),n})}reqOne(e,t){return this.request().then(n=>this.getModel().newFromReq(e,n,t))}reqOneOther(e,t,n){return this.request().then(o=>{const c=o[t],m=this.getModel().newFromReq(e,c,n);return h(u({},r.omit(o,t)),{model:m})})}reqMany(e,t){return this.request().then(n=>{let o=[];for(const c of n)o.push(this.getModel().newFromReq(e,c,t));return o})}reqManyOther(e,t,n){return this.request().then(o=>{const c=o[t],m=[];for(const H of c)m.push(this.getModel().newFromReq(e,H,n));return h(u({},r.omit(o,t)),{models:m})})}}class x extends F{requestHandle(){let{config:e}=this;e.headers||(e.headers={})}responseHandle(){const{response:e}=this;if(!e)throw e;return e.data.returnContent}errorHandle(){return this.error}}const B={default:x,demo:x};let p={},T=u(u({},B),p);function S(l){p=l,Object.assign(T,B,p)}class E extends _{constructor(){super(...arguments);a(this,"defaultUseLoading",!0)}static newReq(e="default"){return new this().newReq(e)}newReq(e="default"){const t=new T[e];if(!t)throw new Error(`${e} \u8BF7\u6C42\u7C7B \u4E0D\u5B58\u5728`);return t.setModel(this).setUseLoading(this.defaultUseLoading)}newFromReq(e,t,n){const o=new e;return o.data=t,n&&n(o),o.proxyData()}}s.BaseLoading=f,s.LoadingRequest=F,s.RequestModel=E,s.setLoadingClassConfig=v,s.setRequestClassConfig=S,Object.defineProperty(s,"__esModule",{value:!0}),s[Symbol.toStringTag]="Module"});
