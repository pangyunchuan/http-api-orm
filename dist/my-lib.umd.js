var S=Object.defineProperty,b=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var M=(s,a,r)=>a in s?S(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,u=(s,a)=>{for(var r in a||(a={}))O.call(a,r)&&M(s,r,a[r]);if(I)for(var r of I(a))W.call(a,r)&&M(s,r,a[r]);return s},c=(s,a)=>b(s,P(a));var i=(s,a,r)=>(M(s,typeof a!="symbol"?a+"":a,r),r);(function(s,a){typeof exports=="object"&&typeof module!="undefined"?a(exports,require("axios"),require("lodash-es")):typeof define=="function"&&define.amd?define(["exports","axios","lodash-es"],a):(s=typeof globalThis!="undefined"?globalThis:s||self,a(s.MyLib={},s.axios,s["lodash-es"]))})(this,function(s,a,r){"use strict";function y(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var p=y(a);class F{constructor(){i(this,"_dataType",{});i(this,"isProxyData",!1)}proxyData(){return this.isProxyData?this:(this.isProxyData=!0,new Proxy(this,{get(t,e){if(e in t)return t[e];if(t.data)return t.data[e]},set(t,e,n){return e in t?(t[e]=n,!0):(t.data&&e in t.data&&(t.data[e]=n),!0)},has(t,e){return e in t||t.data&&e in t.data}}))}}let C={};function B(){return C}function N(l){C=l}let w={};function R(){return w}function x(l){w=l}let f={use:!0};function D(l){f=u(u({},f),l)}class _ extends F{constructor(){super(...arguments);i(this,"useLoading",f.use)}static newReq(t="default"){return new this().newReq(t)}newReq(t="default"){const e=B(),n=new e[t];if(!n)throw new Error(`${t} \u8BF7\u6C42\u7C7B \u4E0D\u5B58\u5728`);return n.setModel(this).setUseLoading(this.useLoading)}newFromReq(t,e,n){const o=new t().proxyData();return o.data=e,n&&n(o),o}}const q=class{constructor(){i(this,"config",{});i(this,"response");i(this,"error")}setCancel(){let{config:t}=this;if(t.cancelMark==="")return;let e;t.cancelMark=e=t.cancelMark||"default";let{cancelMapByMark:n}=q,o=n[e]=n[e]||p.default.CancelToken.source();t.cancelToken=o.token}static cancelByMark(t){let{cancelMapByMark:e}=q;!e[t]||(e[t].cancel(),delete e[t])}request(t={}){return this.config=u(u({},this.config),t),this.requestHandle(),this.setCancel(),p.default.request(this.config).then(e=>(this.response=e,this.responseHandle())).catch(e=>{throw this.error=e,this.errorHandle()})}setGet(t,e={},n={}){return this.config=u(c(u({},this.config),{url:t,params:e}),n),this}setPost(t,e={},n={},o={}){return this.config=u(c(u({},this.config),{url:t,data:e,params:n}),o),this}get(t,e={},n={}){return this.request(u({method:"get",url:t,params:e},n))}post(t,e={},n={},o={}){return this.request(u({method:"post",url:t,data:e},o))}};let L=q;i(L,"cancelMapByMark",{});class T extends L{constructor(){super(...arguments);i(this,"useLoading",f.use);i(this,"loading");i(this,"model")}setUseLoading(t=f.use){return this.useLoading=t,this}setLoading(t={},e="default"){const n=R();return this.loading=new n[e](t),this}getLoading(){return!this.loading&&this.useLoading&&this.setLoading(),this.loading}setModel(t){return this.model=t,this}getModel(){if(!this.model)throw new Error("\u8BF7\u5148\u8BBE\u7F6E\u6A21\u578B");return this.model}request(t={}){let e=this.getLoading();return e==null||e.startLoading(),super.request(t).then(n=>(e==null||e.endLoading(),n)).catch(n=>{throw e==null||e.endLoading(),n})}reqOne(t,e){return this.request().then(n=>this.getModel().newFromReq(t,n,e))}reqOneOther(t,e,n){return this.request().then(o=>{const h=o[e],m=this.getModel().newFromReq(t,h,n);return c(u({},r.omit(o,e)),{model:m})})}reqMany(t,e){return this.request().then(n=>{let o=[];for(const h of n)o.push(this.getModel().newFromReq(t,h,e));return o})}reqManyOther(t,e,n){return this.request().then(o=>{const h=o[e],m=[];for(const k of h)m.push(this.getModel().newFromReq(t,k,n));return c(u({},r.omit(o,e)),{models:m})})}}const d=class{constructor(t={}){i(this,"needWaitLoading",!0);i(this,"reqIngNum",0);i(this,"reqCount",0);i(this,"fullLoadingSingleInst");i(this,"isFull",!1);i(this,"loadingInst");i(this,"_options",{});i(this,"options",{});i(this,"_waitLoading");i(this,"_waitClose");const e=d.defaultConfigByClassName[this.classname]||{};return this.options=u(u(u({},this.options),e),t),this.isFull=this.getIsFull(),this}get classname(){return this.constructor.name}setDefaultConfig(t){d.defaultConfigByClassName[this.classname]=t}get fullInst(){const t=this.constructor.name;return d._firstFullInstMapByClassName[t]||(d._firstFullInstMapByClassName[t]=this),d._firstFullInstMapByClassName[t]}startLoading(){if(!this.isFull){this.loadingInst=this.buildLoading();return}this.fullStart()}endLoading(){if(!this.isFull){this.closeLoading(this.loadingInst);return}this.fullClose()}fullStart(){const t=this.fullInst;t.reqIngNum++,t.reqCount++,t.needWaitLoading&&(t.waitLoading(),t.needWaitLoading=!1),this.upText(this.getText()),t.waitClose.cancel()}get waitLoading(){const t=this.fullInst;return t._waitLoading||(t._waitLoading=r.debounce(()=>{t.fullLoadingSingleInst=this.buildLoading()},1e3)),t._waitLoading}get waitClose(){const t=this.fullInst;return t._waitClose||(t._waitClose=r.debounce(()=>{t.reqIngNum=0,t.reqCount=0,t.needWaitLoading=!0,this.closeLoading(t.fullLoadingSingleInst)},800)),t._waitClose}fullClose(){const t=this.fullInst;t.reqIngNum--,this.upText(this.getText()),t.reqIngNum<=0&&(t.waitLoading.cancel(),t.waitClose())}getText(t="\u52A0\u8F7D\u4E2D"){let{reqCount:e,reqIngNum:n}=this.fullInst;if(e>1){let o=1-n/e;o=(o*100).toFixed(0),t=`\u5DF2\u52A0\u8F7D ${o}%`}return t}};let g=d;i(g,"defaultConfigByClassName",{}),i(g,"_firstFullInstMapByClassName",{}),s.BaseLoading=g,s.LoadingRequest=T,s.RequestModel=_,s.setLoadingConfig=D,s.setLoadingMap=x,s.setRequestMap=N,Object.defineProperty(s,"__esModule",{value:!0}),s[Symbol.toStringTag]="Module"});
