var T=Object.defineProperty,k=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var L=(s,i,o)=>i in s?T(s,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[i]=o,u=(s,i)=>{for(var o in i||(i={}))b.call(i,o)&&L(s,o,i[o]);if(C)for(var o of C(i))U.call(i,o)&&L(s,o,i[o]);return s},c=(s,i)=>k(s,S(i));var r=(s,i,o)=>(L(s,typeof i!="symbol"?i+"":i,o),o);(function(s,i){typeof exports=="object"&&typeof module!="undefined"?i(exports,require("axios"),require("lodash-es")):typeof define=="function"&&define.amd?define(["exports","axios","lodash-es"],i):(s=typeof globalThis!="undefined"?globalThis:s||self,i(s.MyLib={},s.axios,s["lodash-es"]))})(this,function(s,i,o){"use strict";function I(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var M=I(i);class y{constructor(){r(this,"_dataType",{})}proxyData(){return new Proxy(this,{get(t,e){if(e in t)return t[e];if(t.data)return t.data[e]},set(t,e,n){return e in t?(t[e]=n,!0):(t.data&&e in t.data&&(t.data[e]=n),!0)},has(t,e){return e in t||t.data&&e in t.data}})}}let p={};function F(){return p}function B(l){p=l}class N extends y{constructor(){super(...arguments);r(this,"defaultUseLoading",!0)}static newReq(t="default"){return new this().newReq(t)}newReq(t="default"){const e=F(),n=new e[t];if(!n)throw new Error(`${t} \u8BF7\u6C42\u7C7B \u4E0D\u5B58\u5728`);return n.setModel(this).setUseLoading(this.defaultUseLoading)}newFromReq(t,e,n){const a=new t;return a.data=e,n&&n(a),a.proxyData()}}const g=class{constructor(){r(this,"config",{});r(this,"response");r(this,"error")}setCancel(){let{config:t}=this;if(t.cancelMark==="")return;let e;t.cancelMark=e=t.cancelMark||"default";let{cancelMapByMark:n}=g,a=n[e]=n[e]||M.default.CancelToken.source();t.cancelToken=a.token}static cancelByMark(t){let{cancelMapByMark:e}=g;!e[t]||(e[t].cancel(),delete e[t])}request(t={}){return this.config=u(u({},this.config),t),this.requestHandle(),this.setCancel(),M.default.request(this.config).then(e=>(this.response=e,this.responseHandle())).catch(e=>{throw this.error=e,this.errorHandle()})}setGet(t,e={},n={}){return this.config=u(c(u({},this.config),{url:t,params:e}),n),this}setPost(t,e={},n={},a={}){return this.config=u(c(u({},this.config),{url:t,data:e,params:n}),a),this}get(t,e={},n={}){return this.request(u({method:"get",url:t,params:e},n))}post(t,e={},n={},a={}){return this.request(u({method:"post",url:t,data:e},a))}};let m=g;r(m,"cancelMapByMark",{});let w={};function R(){return w}function D(l){w=l}class _ extends m{constructor(){super(...arguments);r(this,"isDefaultUseLoading",!0);r(this,"loading");r(this,"model")}setUseLoading(t=!0){return this.isDefaultUseLoading=t,this}setLoading(t={},e="default"){const n=R();return this.loading=new n[e](t),this}getLoading(){return!this.loading&&this.isDefaultUseLoading&&this.setLoading(),this.loading}setModel(t){return this.model=t,this}getModel(){if(!this.model)throw new Error("\u8BF7\u5148\u8BBE\u7F6E\u6A21\u578B");return this.model}request(t={}){let e=this.getLoading();return e==null||e.startLoading(),super.request(t).then(n=>(e==null||e.endLoading(),n)).catch(n=>{throw e==null||e.endLoading(),n})}reqOne(t,e){return this.request().then(n=>this.getModel().newFromReq(t,n,e))}reqOneOther(t,e,n){return this.request().then(a=>{const f=a[e],q=this.getModel().newFromReq(t,f,n);return c(u({},o.omit(a,e)),{model:q})})}reqMany(t,e){return this.request().then(n=>{let a=[];for(const f of n)a.push(this.getModel().newFromReq(t,f,e));return a})}reqManyOther(t,e,n){return this.request().then(a=>{const f=a[e],q=[];for(const x of f)q.push(this.getModel().newFromReq(t,x,n));return c(u({},o.omit(a,e)),{models:q})})}}const d=class{constructor(t={}){r(this,"needWaitLoading",!0);r(this,"reqIngNum",0);r(this,"reqCount",0);r(this,"fullLoadingSingleInst");r(this,"isFull",!1);r(this,"loadingInst");r(this,"_options",{});r(this,"options",{});r(this,"_waitLoading");r(this,"_waitClose");const e=d.defaultConfigByClassName[this.classname]||{};return this.options=u(u(u({},this.options),e),t),this.isFull=this.getIsFull(),this}get classname(){return this.constructor.name}setDefaultConfig(t){d.defaultConfigByClassName[this.classname]=t}get fullInst(){const t=this.constructor.name;return d._firstFullInstMapByClassName[t]||(d._firstFullInstMapByClassName[t]=this),d._firstFullInstMapByClassName[t]}startLoading(){if(!this.isFull){this.loadingInst=this.buildLoading();return}this.fullStart()}endLoading(){if(!this.isFull){this.closeLoading(this.loadingInst);return}this.fullClose()}fullStart(){const t=this.fullInst;t.reqIngNum++,t.reqCount++,t.needWaitLoading&&(t.waitLoading(),t.needWaitLoading=!1),this.upText(this.getText()),t.waitClose.cancel()}get waitLoading(){const t=this.fullInst;return t._waitLoading||(t._waitLoading=o.debounce(()=>{t.fullLoadingSingleInst=this.buildLoading()},1e3)),t._waitLoading}get waitClose(){const t=this.fullInst;return t._waitClose||(t._waitClose=o.debounce(()=>{t.reqIngNum=0,t.reqCount=0,t.needWaitLoading=!0,this.closeLoading(t.fullLoadingSingleInst)},800)),t._waitClose}fullClose(){const t=this.fullInst;t.reqIngNum--,this.upText(this.getText()),t.reqIngNum<=0&&(t.waitLoading.cancel(),t.waitClose())}getText(t="\u52A0\u8F7D\u4E2D"){let{reqCount:e,reqIngNum:n}=this.fullInst;if(e>1){let a=1-n/e;a=(a*100).toFixed(0),t=`\u5DF2\u52A0\u8F7D ${a}%`}return t}};let h=d;r(h,"defaultConfigByClassName",{}),r(h,"_firstFullInstMapByClassName",{}),s.BaseLoading=h,s.LoadingRequest=_,s.RequestModel=N,s.setLoadingMap=D,s.setRequestMap=B,Object.defineProperty(s,"__esModule",{value:!0}),s[Symbol.toStringTag]="Module"});
