var O=Object.defineProperty;var D=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var y=(i,r,u)=>r in i?O(i,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[r]=u,d=(i,r)=>{for(var u in r||(r={}))U.call(r,u)&&y(i,u,r[u]);if(D)for(var u of D(r))v.call(r,u)&&y(i,u,r[u]);return i};var a=(i,r,u)=>(y(i,typeof r!="symbol"?r+"":r,u),u);(function(i,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("vue"),require("lodash-es"),require("axios")):typeof define=="function"&&define.amd?define(["exports","vue","lodash-es","axios"],r):(i=typeof globalThis!="undefined"?globalThis:i||self,r(i.MyLib={},i.vue,i["lodash-es"],i.axios))})(this,function(i,r,u,B){"use strict";function N(c){return c&&typeof c=="object"&&"default"in c?c:{default:c}}var M=N(B);const o=class{constructor(){a(this,"key","default");a(this,"isSetDestroy",!1)}static baseUse(t,e="default"){var l,g;const s=t.name;o.map[s]=(l=o.map[s])!=null?l:{},o.map[s][e]=(g=o.map[s][e])!=null?g:new t().createRefInst();const n=o.map[s][e].value;return n.key=e,o.map[s][e]}setResetCall(t){var n;const e=this.constructor.name,s=this.key;o.resetCallList[e]=(n=o.resetCallList[e])!=null?n:{},o.resetCallList[e][s]=o.resetCallList[e][s]||[],o.resetCallList[e][s].push(t)}reset(){const t=this.constructor.name,e=this.key,s=this.isSetDestroy,n=new this.constructor;n.key=e,n.isSetDestroy=s,o.map[t][e].value=n;const l=o.resetCallList[t];if(l&&l[e]&&Array.isArray(l[e]))for(const g of l[e])g()}destroy(){const t=this.constructor.name,e=this.key,s=o.map[t];delete s[e],Object.keys(s).length||delete o.map[t]}};let h=o;a(h,"map",{}),a(h,"resetCallList",{});class F extends h{static use(t="default"){return h.baseUse(this,t)}createRefInst(){return{value:this}}}class R extends h{static use(t="default"){return h.baseUse(this,t)}createRefInst(){return r.ref(this)}destroyOnBeforeUnmount(){r.onBeforeUnmount(()=>{this.destroy()})}}class k{constructor(){a(this,"_data");a(this,"isProxyData",!1)}static createModel(t,e){return new this().createModel(t,e)}createModel(t,e,s=!1){const l=(s?new this.constructor:this).proxyData();return t&&(l.data=t),e&&e(l),l}proxyData(){return this.isProxyData?this:(this.isProxyData=!0,new Proxy(this,{get(t,e){if(e in t)return t[e];if(t.data)return t.data[e]},set(t,e,s){return e in t?(t[e]=s,!0):t.data&&e in t.data?(t.data[e]=s,!0):(t[e]=s,!0)},has(t,e){return e in t||t.data&&e in t.data}}))}}let w={};function x(){return w}function S(c){w=c}let I={};function b(){return I}function P(c){I=c}let m={use:!0};function T(c){m=d(d({},m),c)}class p extends k{constructor(){super(...arguments);a(this,"useLoading",m.use);a(this,"_req")}static newReq(t="default"){const e=x(),s=new e[t];if(!s)throw new Error(`${t} \u8BF7\u6C42\u7C7B \u4E0D\u5B58\u5728`);return s}newReq(t="default"){return p.newReq(t)}get req(){if(!this._req)throw new Error("\u8BF7\u6C42\u7C7B \u672A\u8BBE\u7F6E");let t=this.url;const e=this._req.get("url")||"";if(!e&&!t)throw new Error("\u672A\u8BBE\u7F6E\u8BF7\u6C42\u5730\u5740");const s=e.includes("/")?e:`${u.trimEnd(t,"/")}/${u.trim(e,"/")}`;return this._req.set("url",s),this._req}static setReq(t){return new this().setReq(t)}setReq(t){return this._req=t.setUseLoading(this.useLoading),this}async reqOne(t){return this.req.request().then(e=>this.createModel(e,t,!0))}async reqOneOther(t,e){return this.req.request().then(s=>{const n=s[t],l=this.createModel(n,e,!0);return d({model:l},u.omit(s,t))})}async reqMany(t){return this.req.request().then(e=>{let s=[];for(const n of e)s.push(this.createModel(n,t,!0));return s})}async reqManyOther(t,e){return this.req.request().then(s=>{const n=s[t];let l=[];for(const g of n)l.push(this.createModel(g,e,!0));return d({models:l},u.omit(s,t))})}}const L=class{constructor(){a(this,"config",{});a(this,"response");a(this,"error")}setCancel(){let{config:t}=this;if(t.cancelMark==="")return;let e;t.cancelMark=e=t.cancelMark||"default";let{cancelMapByMark:s}=L,n=s[e]=s[e]||M.default.CancelToken.source();t.cancelToken=n.token}static cancelByMark(t){let{cancelMapByMark:e}=L;!e[t]||(e[t].cancel(),delete e[t])}async request(t={}){return this.config=d(d({},this.config),t),this.requestHandle(),this.setCancel(),M.default.request(this.config).then(e=>(this.response=e,this.responseHandle())).catch(e=>{throw this.error=e,this.errorHandle()})}set(t,e){return this.config[t]=e,this}get(t){return this.config[t]}setConfig(t){return this.config=d(d({},this.config),t),this}setNoData(t,e={},s={}){return this.set("url",t).set("params",e).setConfig(s)}setHasData(t,e={},s={},n={}){return this.set("url",t).set("data",e).set("params",s).setConfig(n)}setGet(t="",e={},s={}){return this.set("method","get").setNoData(t,e,s)}setDelete(t="",e={},s={}){return this.set("method","delete").setNoData(t,e,s)}setHead(t="",e={},s={}){return this.set("method","head").setNoData(t,e,s)}setOptions(t="",e={},s={}){return this.set("method","options").setNoData(t,e,s)}setPost(t="",e={},s={},n={}){return this.set("method","post").setHasData(t,e,s,n)}setPut(t="",e={},s={},n={}){return this.set("method","put").setHasData(t,e,s,n)}setPatch(t="",e={},s={},n={}){return this.set("method","patch").setHasData(t,e,s,n)}};let q=L;a(q,"cancelMapByMark",{});class H extends q{constructor(){super(...arguments);a(this,"useLoading",m.use);a(this,"loading")}setUseLoading(t=m.use){return this.useLoading=t,this}setLoading(t={},e="default"){const s=b();return this.loading=new s[e](t),this}getLoading(){return!this.loading&&this.useLoading&&this.setLoading(),this.loading}async request(t={}){let e=this.getLoading();return e==null||e.startLoading(),super.request(t).then(s=>(e==null||e.endLoading(),s)).catch(s=>{throw e==null||e.endLoading(),s})}}const f=class{constructor(t={}){a(this,"needWaitLoading",!0);a(this,"reqIngNum",0);a(this,"reqCount",0);a(this,"fullLoadingSingleInst");a(this,"loadingInst");a(this,"_options",{});a(this,"options",{});a(this,"_waitLoading");a(this,"_waitClose");const e=f.defaultConfigByClassName[this.classname]||{};return this.options=d(d(d({},this.options),e),t),this}get isFull(){return this.getIsFull()}get classname(){return this.constructor.name}static setDefaultConfig(t){f.defaultConfigByClassName[this.name]=t}get fullInst(){const t=this.constructor.name;return f._firstFullInstMapByClassName[t]||(f._firstFullInstMapByClassName[t]=this),f._firstFullInstMapByClassName[t]}startLoading(){if(!this.isFull){this.loadingInst=this.buildLoading();return}this.fullStart()}endLoading(){if(!this.isFull){this.closeLoading(this.loadingInst);return}this.fullClose()}fullStart(){const t=this.fullInst;t.reqIngNum++,t.reqCount++,t.needWaitLoading&&(t.waitLoading(),t.needWaitLoading=!1),this.upText(this.getText()),t.waitClose.cancel()}get waitLoading(){const t=this.fullInst;return t._waitLoading||(t._waitLoading=u.debounce(()=>{t.fullLoadingSingleInst=this.buildLoading()},1e3)),t._waitLoading}get waitClose(){const t=this.fullInst;return t._waitClose||(t._waitClose=u.debounce(()=>{t.reqIngNum=0,t.reqCount=0,t.needWaitLoading=!0,this.closeLoading(t.fullLoadingSingleInst)},800)),t._waitClose}fullClose(){const t=this.fullInst;t.reqIngNum--,this.upText(this.getText()),t.reqIngNum<=0&&(t.waitLoading.cancel(),t.waitClose())}getText(t="\u52A0\u8F7D\u4E2D"){let{reqCount:e,reqIngNum:s}=this.fullInst;if(e>1){let n=1-s/e;n=(n*100).toFixed(0),t=`\u5DF2\u52A0\u8F7D ${n}%`}return t}};let C=f;a(C,"defaultConfigByClassName",{}),a(C,"_firstFullInstMapByClassName",{}),i.BaseLoading=C,i.BaseRequest=q,i.Controller=F,i.LoadingRequest=H,i.RequestModel=p,i.Vue3Controller=R,i.setLoadingConfig=T,i.setLoadingMap=P,i.setRequestMap=S,Object.defineProperty(i,"__esModule",{value:!0}),i[Symbol.toStringTag]="Module"});
