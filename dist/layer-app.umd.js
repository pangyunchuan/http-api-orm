var b=Object.defineProperty;var D=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var y=(n,r,o)=>r in n?b(n,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[r]=o,c=(n,r)=>{for(var o in r||(r={}))v.call(r,o)&&y(n,o,r[o]);if(D)for(var o of D(r))A.call(r,o)&&y(n,o,r[o]);return n};var i=(n,r,o)=>(y(n,typeof r!="symbol"?r+"":r,o),o);(function(n,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("vue"),require("lodash-es"),require("axios")):typeof define=="function"&&define.amd?define(["exports","vue","lodash-es","axios"],r):(n=typeof globalThis!="undefined"?globalThis:n||self,r(n.MyLib={},n.vue,n["lodash-es"],n.axios))})(this,function(n,r,o,N){"use strict";function B(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var M=B(N);const u=class{constructor(){i(this,"key","default");i(this,"isSetDestroy",!1);i(this,"_type")}static useController(t="default"){var s,a;u.map[this.name]=(s=u.map[this.name])!=null?s:{},u.map[this.name][t]=(a=u.map[this.name][t])!=null?a:new this().createManType();const e=u.map[this.name][t].value;return e.key=t,u.map[this.name][t]}setResetCall(t){var a;const e=this.constructor.name,s=this.key;u.resetCallList[e]=(a=u.resetCallList[e])!=null?a:{},u.resetCallList[e][s]=u.resetCallList[e][s]||[],u.resetCallList[e][s].push(t)}reset(){const t=this.constructor.name,e=this.key,s=this.isSetDestroy,a=new this.constructor;a.key=e,a.isSetDestroy=s,u.map[t][e].value=a;const h=u.resetCallList[t];if(h&&h[e]&&Array.isArray(h[e]))for(const q of h[e])q()}destroy(){const t=this.constructor.name,e=this.key,s=u.map[t];delete s[e],Object.keys(s).length||delete u.map[t]}};let f=u;i(f,"map",{}),i(f,"resetCallList",{});class k extends f{createManType(){return{value:this}}}class F extends f{createManType(){return r.ref(this)}destroyOnBeforeUnmount(){r.onBeforeUnmount(()=>{this.destroy()})}}class R{constructor(){i(this,"_data");i(this,"isProxyData",!1)}static createModel(t,e){return new this().createModel(t,e)}createModel(t,e){const s=this.proxyData();return t&&(s.data=t),e&&e(s),s}proxyData(){return this.isProxyData?this:(this.isProxyData=!0,new Proxy(this,{get(t,e){if(e in t)return t[e];if(t.data)return t.data[e]},set(t,e,s){return e in t?(t[e]=s,!0):t.data&&e in t.data?(t.data[e]=s,!0):(t[e]=s,!0)},has(t,e){return e in t||t.data&&e in t.data}}))}}let w={};function x(){return w}function S(l){w=l}let I={};function T(){return I}function H(l){I=l}let g={use:!0};function O(l){g=c(c({},g),l)}class L extends R{constructor(){super(...arguments);i(this,"useLoading",g.use);i(this,"_req")}static newReq(t="default"){const e=x(),s=new e[t];if(!s)throw new Error(`${t} \u8BF7\u6C42\u7C7B \u4E0D\u5B58\u5728`);return s}newReq(t="default"){return L.newReq(t)}get req(){if(!this._req)throw new Error("\u8BF7\u6C42\u7C7B \u672A\u8BBE\u7F6E");return this._req}static setReq(t){return new this().setReq(t)}setReq(t){return this._req=t.setUseLoading(this.useLoading),this}async reqOne(t){return this.req.request().then(e=>this.createModel(e,t))}async reqOneOther(t,e){return this.req.request().then(s=>{const a=s[t],h=this.createModel(a,e);return c({model:h},o.omit(s,t))})}async reqMany(t){return this.req.request().then(e=>{let s=[];for(const a of e)s.push(this.createModel(e,t));return s})}async reqManyOther(t,e){return this.req.request().then(s=>{const a=s[t];let h=[];for(const q of a)h.push(this.createModel(q,e));return c({models:h},o.omit(s,t))})}}const p=class{constructor(){i(this,"config",{});i(this,"response");i(this,"error")}setCancel(){let{config:t}=this;if(t.cancelMark==="")return;let e;t.cancelMark=e=t.cancelMark||"default";let{cancelMapByMark:s}=p,a=s[e]=s[e]||M.default.CancelToken.source();t.cancelToken=a.token}static cancelByMark(t){let{cancelMapByMark:e}=p;!e[t]||(e[t].cancel(),delete e[t])}async request(t={}){return this.config=c(c({},this.config),t),this.requestHandle(),this.setCancel(),M.default.request(this.config).then(e=>(this.response=e,this.responseHandle())).catch(e=>{throw this.error=e,this.errorHandle()})}set(t,e){return this.config[t]=e,this}setConfig(t){return this.config=c(c({},this.config),t),this}setNoData(t,e={},s={}){return this.set("url",t).set("params",e).setConfig(s)}setHasData(t,e={},s={},a={}){return this.set("url",t).set("data",e).set("params",s).setConfig(a)}setGet(t,e={},s={}){return this.set("method","get").setNoData(t,e,s)}setDelete(t,e={},s={}){return this.set("method","delete").setNoData(t,e,s)}setHead(t,e={},s={}){return this.set("method","head").setNoData(t,e,s)}setOptions(t,e={},s={}){return this.set("method","options").setNoData(t,e,s)}setPost(t,e={},s={},a={}){return this.set("method","post").setHasData(t,e,s,a)}setPut(t,e={},s={},a={}){return this.set("method","put").setHasData(t,e,s,a)}setPatch(t,e={},s={},a={}){return this.set("method","patch").setHasData(t,e,s,a)}};let m=p;i(m,"cancelMapByMark",{});class P extends m{constructor(){super(...arguments);i(this,"useLoading",g.use);i(this,"loading")}setUseLoading(t=g.use){return this.useLoading=t,this}setLoading(t={},e="default"){const s=T();return this.loading=new s[e](t),this}getLoading(){return!this.loading&&this.useLoading&&this.setLoading(),this.loading}async request(t={}){let e=this.getLoading();return e==null||e.startLoading(),super.request(t).then(s=>(e==null||e.endLoading(),s)).catch(s=>{throw e==null||e.endLoading(),s})}}const d=class{constructor(t={}){i(this,"needWaitLoading",!0);i(this,"reqIngNum",0);i(this,"reqCount",0);i(this,"fullLoadingSingleInst");i(this,"loadingInst");i(this,"_options",{});i(this,"options",{});i(this,"_waitLoading");i(this,"_waitClose");const e=d.defaultConfigByClassName[this.classname]||{};return this.options=c(c(c({},this.options),e),t),this}get isFull(){return this.getIsFull()}get classname(){return this.constructor.name}static setDefaultConfig(t){d.defaultConfigByClassName[this.name]=t}get fullInst(){const t=this.constructor.name;return d._firstFullInstMapByClassName[t]||(d._firstFullInstMapByClassName[t]=this),d._firstFullInstMapByClassName[t]}startLoading(){if(!this.isFull){this.loadingInst=this.buildLoading();return}this.fullStart()}endLoading(){if(!this.isFull){this.closeLoading(this.loadingInst);return}this.fullClose()}fullStart(){const t=this.fullInst;t.reqIngNum++,t.reqCount++,t.needWaitLoading&&(t.waitLoading(),t.needWaitLoading=!1),this.upText(this.getText()),t.waitClose.cancel()}get waitLoading(){const t=this.fullInst;return t._waitLoading||(t._waitLoading=o.debounce(()=>{t.fullLoadingSingleInst=this.buildLoading()},1e3)),t._waitLoading}get waitClose(){const t=this.fullInst;return t._waitClose||(t._waitClose=o.debounce(()=>{t.reqIngNum=0,t.reqCount=0,t.needWaitLoading=!0,this.closeLoading(t.fullLoadingSingleInst)},800)),t._waitClose}fullClose(){const t=this.fullInst;t.reqIngNum--,this.upText(this.getText()),t.reqIngNum<=0&&(t.waitLoading.cancel(),t.waitClose())}getText(t="\u52A0\u8F7D\u4E2D"){let{reqCount:e,reqIngNum:s}=this.fullInst;if(e>1){let a=1-s/e;a=(a*100).toFixed(0),t=`\u5DF2\u52A0\u8F7D ${a}%`}return t}};let C=d;i(C,"defaultConfigByClassName",{}),i(C,"_firstFullInstMapByClassName",{}),n.BaseLoading=C,n.BaseRequest=m,n.Controller=k,n.LoadingRequest=P,n.RequestModel=L,n.Vue3Controller=F,n.setLoadingConfig=O,n.setLoadingMap=H,n.setRequestMap=S,Object.defineProperty(n,"__esModule",{value:!0}),n[Symbol.toStringTag]="Module"});
