var O=Object.defineProperty;var I=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var L=(i,r,o)=>r in i?O(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o,h=(i,r)=>{for(var o in r||(r={}))v.call(r,o)&&L(i,o,r[o]);if(I)for(var o of I(r))A.call(r,o)&&L(i,o,r[o]);return i};var a=(i,r,o)=>(L(i,typeof r!="symbol"?r+"":r,o),o);(function(i,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("vue"),require("lodash-es"),require("axios")):typeof define=="function"&&define.amd?define(["exports","vue","lodash-es","axios"],r):(i=typeof globalThis!="undefined"?globalThis:i||self,r(i.MyLib={},i.vue,i["lodash-es"],i.axios))})(this,function(i,r,o,B){"use strict";function N(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var M=N(B);const u=class{constructor(){a(this,"key","default");a(this,"isSetDestroy",!1)}static use(t="default"){var s,n;u.map[this.name]=(s=u.map[this.name])!=null?s:{},u.map[this.name][t]=(n=u.map[this.name][t])!=null?n:new this().createManType();const e=u.map[this.name][t].value;return e.key=t,u.map[this.name][t]}setResetCall(t){var n;const e=this.constructor.name,s=this.key;u.resetCallList[e]=(n=u.resetCallList[e])!=null?n:{},u.resetCallList[e][s]=u.resetCallList[e][s]||[],u.resetCallList[e][s].push(t)}reset(){const t=this.constructor.name,e=this.key,s=this.isSetDestroy,n=new this.constructor;n.key=e,n.isSetDestroy=s,u.map[t][e].value=n;const c=u.resetCallList[t];if(c&&c[e]&&Array.isArray(c[e]))for(const y of c[e])y()}destroy(){const t=this.constructor.name,e=this.key,s=u.map[t];delete s[e],Object.keys(s).length||delete u.map[t]}};let f=u;a(f,"map",{}),a(f,"resetCallList",{});class F extends f{constructor(){super(...arguments);a(this,"_type")}createManType(){return{value:this}}}class k extends f{constructor(){super(...arguments);a(this,"_type")}createManType(){return r.ref(this)}destroyOnBeforeUnmount(){r.onBeforeUnmount(()=>{this.destroy()})}}class x{constructor(){a(this,"_data");a(this,"isProxyData",!1)}static createModel(t,e){return new this().createModel(t,e)}createModel(t,e,s=!1){const c=(s?new this.constructor:this).proxyData();return t&&(c.data=t),e&&e(c),c}proxyData(){return this.isProxyData?this:(this.isProxyData=!0,new Proxy(this,{get(t,e){if(e in t)return t[e];if(t.data)return t.data[e]},set(t,e,s){return e in t?(t[e]=s,!0):t.data&&e in t.data?(t.data[e]=s,!0):(t[e]=s,!0)},has(t,e){return e in t||t.data&&e in t.data}}))}}let w={};function R(){return w}function S(l){w=l}let D={};function T(){return D}function P(l){D=l}let g={use:!0};function b(l){g=h(h({},g),l)}class q extends x{constructor(){super(...arguments);a(this,"useLoading",g.use);a(this,"_req")}static newReq(t="default"){const e=R(),s=new e[t];if(!s)throw new Error(`${t} \u8BF7\u6C42\u7C7B \u4E0D\u5B58\u5728`);return s}newReq(t="default"){return q.newReq(t)}get req(){if(!this._req)throw new Error("\u8BF7\u6C42\u7C7B \u672A\u8BBE\u7F6E");let t=this.url;const e=this._req.get("url")||"";if(!e&&!t)throw new Error("\u672A\u8BBE\u7F6E\u8BF7\u6C42\u5730\u5740");return e.includes("/")&&(t=""),this._req.set("url",o.trim(`${o.trim(t,"/")}/${o.trim(e,"/")}`,"/")),this._req}static setReq(t){return new this().setReq(t)}setReq(t){return this._req=t.setUseLoading(this.useLoading),this}async reqOne(t){return this.req.request().then(e=>this.createModel(e,t,!0))}async reqOneOther(t,e){return this.req.request().then(s=>{const n=s[t],c=this.createModel(n,e,!0);return h({model:c},o.omit(s,t))})}async reqMany(t){return this.req.request().then(e=>{let s=[];for(const n of e)s.push(this.createModel(n,t,!0));return s})}async reqManyOther(t,e){return this.req.request().then(s=>{const n=s[t];let c=[];for(const y of n)c.push(this.createModel(y,e,!0));return h({models:c},o.omit(s,t))})}}const p=class{constructor(){a(this,"config",{});a(this,"response");a(this,"error")}setCancel(){let{config:t}=this;if(t.cancelMark==="")return;let e;t.cancelMark=e=t.cancelMark||"default";let{cancelMapByMark:s}=p,n=s[e]=s[e]||M.default.CancelToken.source();t.cancelToken=n.token}static cancelByMark(t){let{cancelMapByMark:e}=p;!e[t]||(e[t].cancel(),delete e[t])}async request(t={}){return this.config=h(h({},this.config),t),this.requestHandle(),this.setCancel(),M.default.request(this.config).then(e=>(this.response=e,this.responseHandle())).catch(e=>{throw this.error=e,this.errorHandle()})}set(t,e){return this.config[t]=e,this}get(t){return this.config[t]}setConfig(t){return this.config=h(h({},this.config),t),this}setNoData(t,e={},s={}){return this.set("url",t).set("params",e).setConfig(s)}setHasData(t,e={},s={},n={}){return this.set("url",t).set("data",e).set("params",s).setConfig(n)}setGet(t="",e={},s={}){return this.set("method","get").setNoData(t,e,s)}setDelete(t="",e={},s={}){return this.set("method","delete").setNoData(t,e,s)}setHead(t="",e={},s={}){return this.set("method","head").setNoData(t,e,s)}setOptions(t="",e={},s={}){return this.set("method","options").setNoData(t,e,s)}setPost(t="",e={},s={},n={}){return this.set("method","post").setHasData(t,e,s,n)}setPut(t="",e={},s={},n={}){return this.set("method","put").setHasData(t,e,s,n)}setPatch(t="",e={},s={},n={}){return this.set("method","patch").setHasData(t,e,s,n)}};let m=p;a(m,"cancelMapByMark",{});class H extends m{constructor(){super(...arguments);a(this,"useLoading",g.use);a(this,"loading")}setUseLoading(t=g.use){return this.useLoading=t,this}setLoading(t={},e="default"){const s=T();return this.loading=new s[e](t),this}getLoading(){return!this.loading&&this.useLoading&&this.setLoading(),this.loading}async request(t={}){let e=this.getLoading();return e==null||e.startLoading(),super.request(t).then(s=>(e==null||e.endLoading(),s)).catch(s=>{throw e==null||e.endLoading(),s})}}const d=class{constructor(t={}){a(this,"needWaitLoading",!0);a(this,"reqIngNum",0);a(this,"reqCount",0);a(this,"fullLoadingSingleInst");a(this,"loadingInst");a(this,"_options",{});a(this,"options",{});a(this,"_waitLoading");a(this,"_waitClose");const e=d.defaultConfigByClassName[this.classname]||{};return this.options=h(h(h({},this.options),e),t),this}get isFull(){return this.getIsFull()}get classname(){return this.constructor.name}static setDefaultConfig(t){d.defaultConfigByClassName[this.name]=t}get fullInst(){const t=this.constructor.name;return d._firstFullInstMapByClassName[t]||(d._firstFullInstMapByClassName[t]=this),d._firstFullInstMapByClassName[t]}startLoading(){if(!this.isFull){this.loadingInst=this.buildLoading();return}this.fullStart()}endLoading(){if(!this.isFull){this.closeLoading(this.loadingInst);return}this.fullClose()}fullStart(){const t=this.fullInst;t.reqIngNum++,t.reqCount++,t.needWaitLoading&&(t.waitLoading(),t.needWaitLoading=!1),this.upText(this.getText()),t.waitClose.cancel()}get waitLoading(){const t=this.fullInst;return t._waitLoading||(t._waitLoading=o.debounce(()=>{t.fullLoadingSingleInst=this.buildLoading()},1e3)),t._waitLoading}get waitClose(){const t=this.fullInst;return t._waitClose||(t._waitClose=o.debounce(()=>{t.reqIngNum=0,t.reqCount=0,t.needWaitLoading=!0,this.closeLoading(t.fullLoadingSingleInst)},800)),t._waitClose}fullClose(){const t=this.fullInst;t.reqIngNum--,this.upText(this.getText()),t.reqIngNum<=0&&(t.waitLoading.cancel(),t.waitClose())}getText(t="\u52A0\u8F7D\u4E2D"){let{reqCount:e,reqIngNum:s}=this.fullInst;if(e>1){let n=1-s/e;n=(n*100).toFixed(0),t=`\u5DF2\u52A0\u8F7D ${n}%`}return t}};let C=d;a(C,"defaultConfigByClassName",{}),a(C,"_firstFullInstMapByClassName",{}),i.BaseLoading=C,i.BaseRequest=m,i.Controller=F,i.LoadingRequest=H,i.RequestModel=q,i.Vue3Controller=k,i.setLoadingConfig=b,i.setLoadingMap=P,i.setRequestMap=S,Object.defineProperty(i,"__esModule",{value:!0}),i[Symbol.toStringTag]="Module"});
